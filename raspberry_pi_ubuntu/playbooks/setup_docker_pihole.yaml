- name: Setup-docker
  hosts: this_rpi
  gather_facts: false
  become: yes
  become_method: su
  become_user: root
  tasks:
  - name: Pull the Pihole image
    community.docker.docker_image:
      name: pihole/pihole:latest
      source: pull
  
  - name: Docker-compose up!
    community.docker.docker_compose:
      definition:
        version: "3"
        services:
          pihole:
            container_name: pihole
            image: pihole/pihole:latest
            ports:
              - "53:53/tcp"
              - "53:53/udp"
              - "67:67/udp"
              - "80:80/tcp"
            environment:
              TZ: 'America/Chicago'
              # WEBPASSWORD: 'set a secure password here or it will be random'
            # Volumes store your data between container upgrades
            volumes:
              - './etc-pihole/:/etc/pihole/'
              - './etc-dnsmasq.d/:/etc/dnsmasq.d/'
            # Recommended but not required (DHCP needs NET_ADMIN)
            #   https://github.com/pi-hole/docker-pi-hole#note-on-capabilities
            cap_add:
              - NET_ADMIN
            restart: unless-stopped
    register: output
  
  - ansible.builtin.debug:
      var: output
